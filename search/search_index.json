{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Introduction","text":"<p><code>homecontrol</code> is a python package that provides interfaces for Phillip's Hue devices and midea air conditioning units. The latter using the <code>msmart</code> package. It also provides a Rest API via Flask and a client for communicating with it which is built to serve the <code>homecontrol-ui</code> website. This site serves as documentation for both.</p>"},{"location":"setup/","title":"Website Setup on Raspberry Pi","text":"<p>To setup <code>homecontrol</code> and <code>homecontrol-ui</code> together on a linux machine follow the below steps.</p>"},{"location":"setup/#building-homecontrol-ui","title":"Building <code>homecontrol-ui</code>","text":"<p>First we will build the website from source. To do this first ensure you have node.js e.g. by following this.</p> <p>Now install yarn with</p> <pre><code>npm install yarn\n</code></pre> <p>Clone the source with</p> <pre><code>git clone https://github.com/2851999/homecontrol-ui.git\n</code></pre> <p>Then navigate into the directory and install the dependencies</p> <pre><code>cd ./homecontrol-ui\nyarn install\n</code></pre> <p>Then build the site with</p> <pre><code>yarn build\n</code></pre> <p>This will build the site producing a folder <code>/build</code> containing the built site.</p>"},{"location":"setup/#installing-dependencies-on-raspberrypi","title":"Installing dependencies on RaspberryPi","text":"<pre><code>sudo apt-get update\nsudo apt-get install apache2\nsudo apt-get install libapache2-mod-wsgi-py3\nsudo apt-get install sqlite3\nsudo apt-get install mariadb-server\n</code></pre>"},{"location":"setup/#setting-up-the-database","title":"Setting up the database","text":"<p>Now secure the database using <pre><code>sudo systemctl start mysql\nsudo mysql_secure_installation\n</code></pre></p> <p>Note<p>You may need to use <code>sudo service mysql start</code> if you are using WSL.</p> </p> <p>Now you may login using <pre><code>sudo mysql -u root -p\n</code></pre></p> <p>You can test the connection works using <code>telnet localhost 3306</code>.</p> <p>Now create the database and user for homecontrol using <pre><code>create database homecontrol;\ngrant all privileges on homecontrol.* TO 'INSERT_USERNAME'@'localhost' identified by 'INSERT_PASSWORD';\nflush privileges;\n</code></pre></p>"},{"location":"setup/#installing-homecontrol","title":"Installing <code>homecontrol</code>","text":"<pre><code>git clone https://github.com/2851999/homecontrol.git\n\ncd ./homecontrol\npip install .\n</code></pre>"},{"location":"setup/#adding-configuration-files","title":"Adding configuration files","text":"<p>'homecontrol' requires several config files to function. Examples are found in the source for</p> <ul> <li><code>aircon.json</code></li> <li><code>hue.json</code></li> <li><code>api.json</code></li> <li><code>client.json</code></li> <li><code>scheduler.json</code></li> <li><code>database.json</code></li> </ul> <p>These should be placed into a folder at <code>/etc/homecontrol</code>.</p>"},{"location":"setup/#initialising-the-database-and-adding-an-admin-user","title":"Initialising the database and adding an admin user","text":"<pre><code>homecontrol-management init-db\nhomecontrol-management add user admin --group admin\n</code></pre>"},{"location":"setup/#copying-the-built-website","title":"Copying the built website","text":"<p>Copy the the built site files to <code>/var/www/html</code> so they can be served by Apache.</p>"},{"location":"setup/#adding-configuration","title":"Adding configuration","text":""},{"location":"setup/#wsgi","title":"WSGI","text":"<p>Create a file <code>/var/www/homecontrol/api.wsgi</code> with the following contents</p> <pre><code>import sys\nsys.path.insert(0, '/var/www/homecontrol')\nfrom homecontrol.api.main import app as application\n</code></pre>"},{"location":"setup/#apache","title":"Apache","text":"<pre><code>Listen 5000\nWSGIPythonPath /usr/local/lib/python3.9/dist-packages/\n&lt;VirtualHost *:5000&gt;\nWSGIDaemonProcess homecontrol user=www-data group=www-data threads=2\n        WSGIScriptAlias / /var/www/homecontrol/api.wsgi\n&lt;Directory \"/var/www/homecontrol\"&gt;\nWSGIProcessGroup homecontrol\n                WSGIScriptReloading On\nWSGIApplicationGroup %{GLOBAL}\n                Require all granted\n        &lt;/Directory&gt;\nErrorLog /var/log/homecontrol/error.log\n&lt;/VirtualHost&gt;\n&lt;VirtualHost *:80&gt;\n&lt;Directory \"/var/www/html\"&gt;\nRequire all granted\n        &lt;/Directory&gt;\n&lt;/VirtualHost&gt;\n</code></pre>"},{"location":"setup/#starting-the-site","title":"Starting the site","text":"<p>Enable the site and restart apache</p> <pre><code>sudo /usr/sbin/a2ensite homecontrol.conf\nsudo systemctl restart apache2\n</code></pre> <p>Warning</p> <p>WSGIPythonPath should point to your python path</p> <p>Warning</p> <p>You may need to create the log directory manually in order to get the site to start <pre><code>sudo mkdir /var/log/homecontrol\n</code></pre></p>"},{"location":"setup/#setup-the-scheduler","title":"Setup the scheduler","text":"<p>For monitoring, setup the scheduler as a systemd service. This can be done by creating a file at <code>/etc/systemd/system/homecontrol-scheduler.service</code> with the following contents</p> <pre><code>[Unit]\nDescription=homecontrol-scheduler\nAfter=network.target\n[Service]\nUser=www-data\nGroup=www-data\nType=simple\nRestart=always\nExecStartPre=homecontrol-scheduler init-db\nExecStart=homecontrol-scheduler\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Note</p> <p>The <code>database.path</code> parameter in <code>scheduler.json</code> must exist and the folder that will contain the database must have permissions for the users that <code>homecontrol-scheduler</code> and <code>homecontrol.api</code> runs with.</p> <p>This can be achieved using</p> <pre><code>sudo chown -R www-data:www-data &lt;folder&gt;\n</code></pre> <p>Now reload the daemon and enable/start the service</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable homecontrol-scheduler.service\nsudo systemctl start homecontrol-scheduler\n</code></pre>"}]}